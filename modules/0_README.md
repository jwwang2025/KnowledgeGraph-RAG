# Modules ç›®å½•è¯´æ˜æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† `modules` æ–‡ä»¶å¤¹çš„ç›®å½•ç»“æ„ä»¥åŠå„ä¸ªæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ä½œç”¨ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
modules/
â”œâ”€â”€ 0_README.md                    # æœ¬è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ knowledge_graph_builder.py     # çŸ¥è¯†å›¾è°±æ„å»ºå™¨ä¸»ç±»
â”œâ”€â”€ model_trainer.py               # SPN4RE æ¨¡å‹è®­ç»ƒå™¨
â”œâ”€â”€ prepare/                       # æ•°æ®é¢„å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cprint.py                  # å½©è‰²æ‰“å°å·¥å…·
â”‚   â”œâ”€â”€ filter.py                  # è‡ªåŠ¨è¿‡æ»¤é”™è¯¯ä¸‰å…ƒç»„
â”‚   â”œâ”€â”€ preprocess.py              # æ–‡æœ¬æ¸…æ´—å’Œå¥å­åˆ†å‰²
â”‚   â”œâ”€â”€ process.py                 # UIE å…³ç³»æŠ½å–æ‰§è¡Œ
â”‚   â””â”€â”€ utils.py                   # çŸ¥è¯†å›¾è°±ç²¾ç‚¼å·¥å…·å‡½æ•°
â”œâ”€â”€ SPN4RE/                        # SPN4RE å…³ç³»æŠ½å–æ¨¡å‹å®ç°
â”‚   â”œâ”€â”€ main.py                    # æ¨¡å‹è®­ç»ƒä¸»å…¥å£
â”‚   â”œâ”€â”€ README.md                  # SPN4RE ä½¿ç”¨è¯´æ˜
â”‚   â”œâ”€â”€ models/                    # æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ matcher.py
â”‚   â”‚   â”œâ”€â”€ seq_encoder.py
â”‚   â”‚   â”œâ”€â”€ set_criterion.py
â”‚   â”‚   â”œâ”€â”€ set_decoder.py
â”‚   â”‚   â””â”€â”€ setpred4RE.py
â”‚   â”œâ”€â”€ trainer/                   # è®­ç»ƒå™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ trainer.py
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ alphabet.py
â”‚   â”‚   â”œâ”€â”€ average_meter.py
â”‚   â”‚   â”œâ”€â”€ data.py
â”‚   â”‚   â”œâ”€â”€ functions.py
â”‚   â”‚   â””â”€â”€ metric.py
â”‚   â”œâ”€â”€ data/                      # æ•°æ®ç›®å½•
â”‚   â”‚   â”œâ”€â”€ generated_data/        # ç”Ÿæˆçš„æ•°æ®
â”‚   â”‚   â”œâ”€â”€ NYT/                   # NYT æ•°æ®é›†
â”‚   â”‚   â”œâ”€â”€ WebNLG/                # WebNLG æ•°æ®é›†
â”‚   â”‚   â””â”€â”€ zhijian_data_v*/       # è‡ªå®šä¹‰æ•°æ®é›†
â”‚   â””â”€â”€ bert_pretrain/             # BERT é¢„è®­ç»ƒæ¨¡å‹é…ç½®
â”œâ”€â”€ fewshot_model/                 # å°‘æ ·æœ¬å­¦ä¹ æ¨¡å‹
â”‚   â”œâ”€â”€ preprocess.py
â”‚   â”œâ”€â”€ process.py
â”‚   â””â”€â”€ run_fewshot.py
â””â”€â”€ Uie-finetune/                  # UIE æ¨¡å‹å¾®è°ƒç›¸å…³
    â”œâ”€â”€ annotation/                # æ ‡æ³¨æ•°æ®
    â””â”€â”€ deploy/                    # éƒ¨ç½²ç›¸å…³ä»£ç 
```

## ğŸ“„ æ–‡ä»¶è¯¦ç»†è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

#### `knowledge_graph_builder.py`
**ä½œç”¨**: çŸ¥è¯†å›¾è°±æ„å»ºå™¨ä¸»ç±»ï¼Œè´Ÿè´£æ•´ä¸ªçŸ¥è¯†å›¾è°±æ„å»ºçš„å®Œæ•´æµç¨‹ã€‚

**ä¸»è¦åŠŸèƒ½**:
- `get_base_kg_from_txt()`: ä»åŸå§‹æ–‡æœ¬æ–‡ä»¶ç”ŸæˆåŸºç¡€çŸ¥è¯†å›¾è°±
  - ä½¿ç”¨ UIE è¿›è¡Œå…³ç³»æŠ½å–
  - è‡ªåŠ¨è¿‡æ»¤é”™è¯¯ä¸‰å…ƒç»„
  - äººå·¥ç­›é€‰å’Œç²¾ç‚¼çŸ¥è¯†å›¾è°±
- `run_iteration()`: è¿è¡Œä¸€æ¬¡è¿­ä»£è®­ç»ƒ
  - è®­ç»ƒ SPN4RE æ¨¡å‹
  - å¯¹é½é¢„æµ‹ç»“æœ
  - æ‰©å±•çŸ¥è¯†å›¾è°±
- `extend_ratio()`: è®¡ç®—çŸ¥è¯†å›¾è°±æ‰©å±•æ¯”ä¾‹ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æ”¶æ•›
- `save()` / `load()`: ä¿å­˜å’ŒåŠ è½½è®­ç»ƒçŠ¶æ€ï¼Œæ”¯æŒæ–­ç‚¹ç»­è®­

#### `model_trainer.py`
**ä½œç”¨**: SPN4RE æ¨¡å‹è®­ç»ƒå™¨ï¼Œå°è£…äº†æ¨¡å‹è®­ç»ƒã€æµ‹è¯•å’Œç»“æœå¤„ç†çš„å…¨æµç¨‹ã€‚

**ä¸»è¦åŠŸèƒ½**:
- `split_data()`: å°†æ•°æ®é›†æŒ‰ 5:2:3 æ¯”ä¾‹åˆ‡åˆ†ä¸ºè®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†
- `generate_running_cmd()`: ç”Ÿæˆ SPN4RE è®­ç»ƒå‘½ä»¤
- `train_and_test()`: æ‰§è¡Œæ¨¡å‹è®­ç»ƒå’Œæµ‹è¯•
- `relation_align()`: å°†é¢„æµ‹ç»“æœä¸æµ‹è¯•é›†å¯¹é½ï¼Œå»é™¤é‡å¤ä¸‰å…ƒç»„
- `refine_and_extend()`: ç²¾ç‚¼çŸ¥è¯†å›¾è°±å¹¶ä¸åŸå§‹æ•°æ®åˆå¹¶



### SPN4RE/ å…³ç³»æŠ½å–æ¨¡å‹

#### `main.py`
**ä½œç”¨**: SPN4RE æ¨¡å‹è®­ç»ƒçš„ä¸»å…¥å£æ–‡ä»¶ã€‚

**ä¸»è¦åŠŸèƒ½**:
- è§£æå‘½ä»¤è¡Œå‚æ•°ï¼ˆæ•°æ®é›†è·¯å¾„ã€æ¨¡å‹å‚æ•°ã€è®­ç»ƒè¶…å‚æ•°ç­‰ï¼‰
- æ„å»ºæ•°æ®é›†
- åˆå§‹åŒ– SetPred4RE æ¨¡å‹
- æ‰§è¡Œè®­ç»ƒæµç¨‹

**SPN4RE ç®€ä»‹**: 
- Set Prediction Networks for Relation Extraction
- åŸºäºé›†åˆé¢„æµ‹ç½‘ç»œçš„å…³ç³»æŠ½å–æ¨¡å‹
- æ”¯æŒè”åˆå®ä½“å’Œå…³ç³»æŠ½å–
- ä½¿ç”¨ BERT ä½œä¸ºç¼–ç å™¨ï¼ŒTransformer è§£ç å™¨ç”Ÿæˆä¸‰å…ƒç»„é›†åˆ

#### `models/`
**ä½œç”¨**: æ¨¡å‹å®šä¹‰ç›®å½•ã€‚

- `setpred4RE.py`: SetPred4RE ä¸»æ¨¡å‹ç±»
- `seq_encoder.py`: åºåˆ—ç¼–ç å™¨ï¼ˆBERTï¼‰
- `set_decoder.py`: é›†åˆè§£ç å™¨ï¼ˆTransformerï¼‰
- `matcher.py`: åŒ¹é…å™¨ï¼ˆç”¨äºè®¡ç®—æŸå¤±ï¼‰
- `set_criterion.py`: æŸå¤±å‡½æ•°å®šä¹‰

#### `trainer/trainer.py`
**ä½œç”¨**: æ¨¡å‹è®­ç»ƒå™¨ï¼Œè´Ÿè´£è®­ç»ƒå¾ªç¯ã€éªŒè¯å’Œæµ‹è¯•ã€‚

#### `utils/`
**ä½œç”¨**: å·¥å…·å‡½æ•°ç›®å½•ã€‚

- `data.py`: æ•°æ®åŠ è½½å’Œé¢„å¤„ç†
- `alphabet.py`: å…³ç³»æ ‡ç­¾å­—å…¸ç®¡ç†
- `metric.py`: è¯„ä¼°æŒ‡æ ‡è®¡ç®—
- `functions.py`: é€šç”¨å·¥å…·å‡½æ•°
- `average_meter.py`: å¹³å‡å€¼è®¡ç®—å™¨


### Uie-finetune/ UIE å¾®è°ƒ

**ä½œç”¨**: UIE æ¨¡å‹å¾®è°ƒå’Œéƒ¨ç½²ç›¸å…³ä»£ç ã€‚

**ç›®å½•**:
- `annotation/`: æ ‡æ³¨æ•°æ®ç›®å½•ï¼ŒåŒ…å«ä¸åŒç‰ˆæœ¬çš„æ ‡æ³¨æ•°æ®
- `deploy/`: éƒ¨ç½²ç›¸å…³ä»£ç 
  - `python/`: Python æ¨ç†ä»£ç ï¼ˆCPU/GPUï¼‰
  - `serving/`: æœåŠ¡åŒ–éƒ¨ç½²ä»£ç 

## ğŸ”„ å·¥ä½œæµç¨‹

1. **æ•°æ®é¢„å¤„ç†** (`prepare/`)
   - æ–‡æœ¬æ¸…æ´—å’Œåˆ†å‰² (`preprocess.py`)
   - UIE å…³ç³»æŠ½å– (`process.py`)
   - è‡ªåŠ¨è¿‡æ»¤é”™è¯¯ä¸‰å…ƒç»„ (`filter.py`)

2. **åŸºç¡€çŸ¥è¯†å›¾è°±æ„å»º** (`knowledge_graph_builder.py`)
   - è°ƒç”¨é¢„å¤„ç†æ¨¡å—ç”ŸæˆåŸºç¡€ä¸‰å…ƒç»„
   - äººå·¥ç­›é€‰ç²¾ç‚¼ (`utils.py`)

3. **è¿­ä»£è®­ç»ƒ** (`knowledge_graph_builder.py` + `model_trainer.py`)
   - ä½¿ç”¨ SPN4RE æ¨¡å‹è®­ç»ƒ (`SPN4RE/main.py`)
   - é¢„æµ‹æ–°ä¸‰å…ƒç»„
   - å¯¹é½å’Œåˆå¹¶ç»“æœ

4. **çŸ¥è¯†å›¾è°±æ‰©å±•**
   - è®¡ç®—æ‰©å±•æ¯”ä¾‹
   - åˆ¤æ–­æ˜¯å¦æ”¶æ•›
   - ä¿å­˜æœ€ç»ˆçŸ¥è¯†å›¾è°±

## ğŸ”— ç›¸å…³èµ„æº

- SPN4RE è®ºæ–‡: [Joint Entity and Relation Extraction with Set Prediction Networks](https://arxiv.org/abs/2011.01675)
- PaddleNLP UIE: [Universal Information Extraction](https://github.com/PaddlePaddle/PaddleNLP)

